<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Bancas de TCC</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
// Usando React global do CDN
const { useState, useEffect, useCallback } = React;

// Usando Firebase global do CDN (versão compatível)
const { initializeApp } = firebase;
const { getAuth, signInAnonymously, onAuthStateChanged } = firebase.auth;
const { getFirestore, collection, query, onSnapshot, addDoc, updateDoc, deleteDoc, doc } = firebase.firestore;

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyApVowmy3H-srgXGD6GYpOaocrQpvNcJmw",
  authDomain: "bancas-7806e.firebaseapp.com",
  projectId: "bancas-7806e",
  storageBucket: "bancas-7806e.firebasestorage.app",
  messagingSenderId: "1007374523919",
  appId: "1:1007374523919:web:4395f918961df8cece0d7a"
};

// Componente principal da aplicação
const App = () => {
  // Inicializar Firebase dentro do componente
  const [firebaseReady, setFirebaseReady] = useState(false);
  const [app, setApp] = useState(null);
  const [db, setDb] = useState(null);
  const [auth, setAuth] = useState(null);

  // Inicializar Firebase quando o componente montar
  useEffect(() => {
    try {
      // Aguardar um pouco para garantir que o Firebase está carregado
      setTimeout(() => {
        if (typeof firebase !== 'undefined') {
          const firebaseApp = initializeApp(firebaseConfig);
          const firestoreDb = firebase.firestore(firebaseApp);
          const authInstance = firebase.auth(firebaseApp);
          
          setApp(firebaseApp);
          setDb(firestoreDb);
          setAuth(authInstance);
          setFirebaseReady(true);
        } else {
          console.error("Firebase não está disponível");
        }
      }, 1000);
    } catch (error) {
      console.error("Erro ao inicializar Firebase:", error);
    }
  }, []);

  // Estados da aplicação
  const [bancas, setBancas] = useState([]); // Lista de bancas
  
  // Configurações iniciais - agora mais flexíveis
  const [configuracoes, setConfiguracoes] = useState({
    periodoAtual: '2025.1', // Período atual (ex: 2025.1, 2025.2, 2026.1)
    salas: ["Sala de Arte e Tecnologia", "Auditório Mário Meireles", "(on-line)"],
    datas: ["2025-08-04", "2025-08-05", "2025-08-06", "2025-08-07", "2025-08-08"],
    professores: [
      "Dinho", "Elisene", "Frederico", "Isabel", "Jordana", "Larissa",
      "Luísa", "Maira", "Marcelo", "Mariana", "Mateus", "Murilo",
      "Pablo", "Plínio", "Paulo César", "Vinícius"
    ]
  });

  // Estados para gerenciamento de períodos
  const [periodos, setPeriodos] = useState(['2025.1']); // Lista de períodos disponíveis
  const [periodoSelecionado, setPeriodoSelecionado] = useState('2025.1');
  const [showConfigModal, setShowConfigModal] = useState(false);
  const [novaConfiguracao, setNovaConfiguracao] = useState({
    periodo: '',
    salas: '',
    datas: '',
    professores: ''
  });

  const [professores, setProfessores] = useState(configuracoes.professores);
  const [salas, setSalas] = useState(configuracoes.salas);
  const [datasDisponiveis, setDatasDisponiveis] = useState(configuracoes.datas);

  const [novaBanca, setNovaBanca] = useState({ // Estado para nova banca a ser adicionada
    data: '',
    horarioInicio: '',
    horarioFim: '',
    local: '',
    discente: '',
    titulo: '',
    orientador: '',
    avaliador1: '', // Novo campo para Avaliador 1
    avaliador2: '', // Novo campo para Avaliador 2
  });
  const [editandoBancaId, setEditandoBancaId] = useState(null); // ID da banca sendo editada
  const [erro, setErro] = useState(''); // Mensagens de erro
  const [sucesso, setSucesso] = useState(''); // Mensagens de sucesso
  const [userId, setUserId] = useState(null); // ID do usuário autenticado
  const [isAuthReady, setIsAuthReady] = useState(false); // Indica se a autenticação está pronta
  const [showModal, setShowModal] = useState(false); // Estado para controlar a visibilidade do modal
  const [modalMessage, setModalMessage] = useState(''); // Mensagem do modal
  const [modalType, setModalType] = useState(''); // Tipo do modal (success, error, confirm)
  const [modalAction, setModalAction] = useState(null); // Ação a ser executada ao confirmar o modal

  // Função para exibir o modal
  const showCustomModal = useCallback((message, type, action = null) => {
    setModalMessage(message);
    setModalType(type);
    setModalAction(() => action);
    setShowModal(true);
  }, []);

  // Função para fechar o modal
  const closeCustomModal = useCallback(() => {
    setShowModal(false);
    setModalMessage('');
    setModalType('');
    setModalAction(null);
  }, []);

  // Função para carregar configurações do período
  const carregarConfiguracoes = useCallback(async (periodo) => {
    if (!firebaseReady || !db || !userId) return;

    try {
      const configRef = db.collection(`users/${userId}/configuracoes`).doc(periodo);
      const doc = await configRef.get();
      
      if (doc.exists) {
        const config = doc.data();
        setConfiguracoes(config);
        setProfessores(config.professores || []);
        setSalas(config.salas || []);
        setDatasDisponiveis(config.datas || []);
      } else {
        // Usar configurações padrão se não existir
        const configPadrao = {
          periodoAtual: periodo,
          salas: configuracoes.salas,
          datas: configuracoes.datas,
          professores: configuracoes.professores
        };
        setConfiguracoes(configPadrao);
        setProfessores(configPadrao.professores);
        setSalas(configPadrao.salas);
        setDatasDisponiveis(configPadrao.datas);
      }
    } catch (error) {
      console.error("Erro ao carregar configurações:", error);
    }
  }, [firebaseReady, db, userId, configuracoes]);

  // Função para salvar configurações do período
  const salvarConfiguracoes = useCallback(async (periodo, config) => {
    if (!firebaseReady || !db || !userId) return;

    try {
      await db.collection(`users/${userId}/configuracoes`).doc(periodo).set(config);
      showCustomModal("Configurações salvas com sucesso!", "success");
    } catch (error) {
      console.error("Erro ao salvar configurações:", error);
      showCustomModal("Erro ao salvar configurações.", "error");
    }
  }, [firebaseReady, db, userId, showCustomModal]);

  // Função para criar novo período ou atualizar existente
  const criarNovoPeriodo = useCallback(async () => {
    if (!novaConfiguracao.periodo) {
      showCustomModal("Por favor, informe o nome do período.", "error");
      return;
    }

    const periodo = novaConfiguracao.periodo;
    const novasConfigs = {
      periodoAtual: periodo,
      salas: novaConfiguracao.salas.split(',').map(s => s.trim()).filter(s => s),
      datas: novaConfiguracao.datas.split(',').map(d => d.trim()).filter(d => d),
      professores: novaConfiguracao.professores.split(',').map(p => p.trim()).filter(p => p)
    };

    await salvarConfiguracoes(periodo, novasConfigs);
    
    // Se é um período novo, adicionar à lista
    if (!periodos.includes(periodo)) {
      setPeriodos(prev => [...prev, periodo]);
    }
    
    setPeriodoSelecionado(periodo);
    setShowConfigModal(false);
    setNovaConfiguracao({ periodo: '', salas: '', datas: '', professores: '' });
  }, [novaConfiguracao, salvarConfiguracoes, showCustomModal, periodos]);

  // Efeito para autenticar o usuário e inicializar o listener de autenticação
  useEffect(() => {
    if (!firebaseReady || !auth) return;

    // Usar um ID fixo para simular autenticação (para desenvolvimento)
    const userId = 'user-' + Date.now();
    setUserId(userId);
    setIsAuthReady(true);
    console.log("Usuário simulado:", userId);

    // Tentar autenticação anônima se disponível
    const authenticate = async () => {
      try {
        await auth.signInAnonymously();
        console.log("Autenticação anônima bem-sucedida");
      } catch (error) {
        console.log("Autenticação anônima não disponível, usando modo simulado");
        // Não mostrar erro, apenas usar o modo simulado
      }
    };

    authenticate();
  }, [firebaseReady, auth]);

  // Efeito para carregar períodos disponíveis
  useEffect(() => {
    if (!firebaseReady || !db || !isAuthReady || !userId) return;

    const periodosRef = db.collection(`users/${userId}/configuracoes`);
    
    const unsubscribe = periodosRef.onSnapshot((snapshot) => {
      const periodosData = snapshot.docs.map(doc => doc.id);
      if (periodosData.length > 0) {
        setPeriodos(periodosData);
        if (!periodoSelecionado || !periodosData.includes(periodoSelecionado)) {
          setPeriodoSelecionado(periodosData[0]);
        }
      }
    }, (error) => {
      console.error("Erro ao carregar períodos:", error);
    });

    return () => unsubscribe();
  }, [firebaseReady, db, userId, isAuthReady, periodoSelecionado]);

  // Efeito para carregar configurações quando o período mudar
  useEffect(() => {
    if (periodoSelecionado) {
      carregarConfiguracoes(periodoSelecionado);
    }
  }, [periodoSelecionado, carregarConfiguracoes]);

  // Efeito para carregar as bancas do Firestore quando o userId estiver disponível
  useEffect(() => {
    if (!firebaseReady || !db || !isAuthReady || !userId || !periodoSelecionado) return;

    const bancasRef = db.collection(`users/${userId}/periodos/${periodoSelecionado}/bancas`);
    const q = bancasRef;

    const unsubscribe = q.onSnapshot((snapshot) => {
      const bancasData = snapshot.docs.map(doc => {
        const data = doc.data();
        return {
          id: doc.id,
          ...data,
        };
      });
      setBancas(bancasData);

      // Extrair professores, salas e datas únicas das bancas existentes
      const allProfessores = new Set(configuracoes.professores || []);
      const allSalas = new Set(configuracoes.salas || []);
      const allDatas = new Set(configuracoes.datas || []);

      bancasData.forEach(banca => {
        allProfessores.add(banca.orientador);
        if (banca.avaliador1) allProfessores.add(banca.avaliador1);
        if (banca.avaliador2) allProfessores.add(banca.avaliador2);
        allSalas.add(banca.local);
        allDatas.add(banca.data);
      });
      
      setProfessores(Array.from(allProfessores).sort());
      setSalas(Array.from(allSalas).sort());
      setDatasDisponiveis(Array.from(allDatas).sort());
    }, (error) => {
      console.error("Erro ao carregar bancas:", error);
      showCustomModal("Erro ao carregar bancas. Por favor, tente novamente.", "error");
    });

    return () => unsubscribe();
  }, [firebaseReady, db, userId, isAuthReady, periodoSelecionado, configuracoes, showCustomModal]);

  // Função para lidar com a mudança nos campos do formulário
  const handleChange = (e) => {
    const { name, value } = e.target;
    if (name === "data" && value === "Outra") {
      // Se "Outra" for selecionado, limpa o campo de data para permitir a digitação
      setNovaBanca(prev => ({ ...prev, data: '' }));
    } else {
      setNovaBanca(prev => ({ ...prev, [name]: value }));
    }
  };

  // Função para validar a nova banca antes de adicionar/atualizar
  const validarBanca = useCallback((banca, idAtual = null) => {
    setErro('');
    setSucesso('');

    const { data, horarioInicio, horarioFim, local, orientador, avaliador1, avaliador2 } = banca;

    if (!data || !horarioInicio || !horarioFim || !local || !orientador || !avaliador1 || !avaliador2) {
      return "Todos os campos (Data, Horário, Local, Discente, Título, Orientador, Avaliador 1 e Avaliador 2) são obrigatórios.";
    }

    if (orientador === avaliador1 || orientador === avaliador2 || avaliador1 === avaliador2) {
      return "O Orientador, Avaliador 1 e Avaliador 2 devem ser professores diferentes.";
    }

    const [hInicio, mInicio] = horarioInicio.split(':').map(Number);
    const [hFim, mFim] = horarioFim.split(':').map(Number);

    const inicio = hInicio * 60 + mInicio;
    const fim = hFim * 60 + mFim;

    if (fim <= inicio) {
      return "O horário de término deve ser posterior ao horário de início.";
    }

    const professoresDaNovaBanca = [orientador, avaliador1, avaliador2];

    // Verificar conflitos
    for (const existente of bancas) {
      if (existente.id === idAtual) continue; // Ignorar a própria banca ao editar

      if (existente.data === data) {
        const [existenteHInicio, existenteMInicio] = existente.horarioInicio.split(':').map(Number);
        const [existenteHFim, existenteMFim] = existente.horarioFim.split(':').map(Number);

        const existenteInicio = existenteHInicio * 60 + existenteMInicio;
        const existenteFim = existenteHFim * 60 + existenteMFim;

        // Conflito de horário
        const sobreposicaoHorario = (inicio < existenteFim && fim > existenteInicio);

        if (sobreposicaoHorario) {
          // Conflito de sala
          if (existente.local === local) {
            return `A sala "${local}" já está ocupada neste horário.`;
          }

          // Conflito de professor
          const professoresDaBancaExistente = [existente.orientador, existente.avaliador1, existente.avaliador2].filter(Boolean); // Filter Boolean para remover vazios/nulos

          const professoresConflito = professoresDaNovaBanca.filter(prof =>
            professoresDaBancaExistente.includes(prof)
          );

          if (professoresConflito.length > 0) {
            return `O(s) professor(es) ${professoresConflito.join(', ')} já está(ão) em outra banca neste horário.`;
          }
        }
      }
    }
    return null; // Nenhuma validação falhou
  }, [bancas]);

  // Função para adicionar ou atualizar uma banca
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!firebaseReady || !db || !userId) {
      showCustomModal("Sistema não está pronto. Por favor, aguarde um momento.", "error");
      return;
    }

    const validacaoErro = validarBanca(novaBanca, editandoBancaId);
    if (validacaoErro) {
      setErro(validacaoErro);
      showCustomModal(validacaoErro, "error");
      return;
    }

    try {
      // Salva os campos diretamente no Firestore
      const bancaParaSalvar = {
        data: novaBanca.data,
        horarioInicio: novaBanca.horarioInicio,
        horarioFim: novaBanca.horarioFim,
        local: novaBanca.local,
        discente: novaBanca.discente,
        titulo: novaBanca.titulo,
        orientador: novaBanca.orientador,
        avaliador1: novaBanca.avaliador1,
        avaliador2: novaBanca.avaliador2,
      };

      if (editandoBancaId) {
        // Atualizar banca existente
        const bancaRef = db.collection(`users/${userId}/periodos/${periodoSelecionado}/bancas`).doc(editandoBancaId);
        await bancaRef.update(bancaParaSalvar);
        setSucesso("Banca atualizada com sucesso!");
        showCustomModal("Banca atualizada com sucesso!", "success");
        setEditandoBancaId(null);
      } else {
        // Adicionar nova banca
        await db.collection(`users/${userId}/periodos/${periodoSelecionado}/bancas`).add(bancaParaSalvar);
        setSucesso("Banca adicionada com sucesso!");
        showCustomModal("Banca adicionada com sucesso!", "success");
      }
      // Limpar formulário
      setNovaBanca({
        data: '',
        horarioInicio: '',
        horarioFim: '',
        local: '',
        discente: '',
        titulo: '',
        orientador: '',
        avaliador1: '',
        avaliador2: '',
      });
      setErro('');
    } catch (error) {
      console.error("Erro ao salvar banca:", error);
      setErro("Erro ao salvar banca. Por favor, tente novamente.");
      showCustomModal("Erro ao salvar banca. Por favor, tente novamente.", "error");
    }
  };

  // Função para preencher o formulário para edição
  const handleEdit = (banca) => {
    setNovaBanca({
      data: banca.data,
      horarioInicio: banca.horarioInicio,
      horarioFim: banca.horarioFim,
      local: banca.local,
      discente: banca.discente,
      titulo: banca.titulo,
      orientador: banca.orientador,
      avaliador1: banca.avaliador1 || '', // Garante que é string vazia se undefined/null
      avaliador2: banca.avaliador2 || '', // Garante que é string vazia se undefined/null
    });
    setEditandoBancaId(banca.id);
    setErro('');
    setSucesso('');
  };

  // Função para confirmar a exclusão de uma banca
  const handleDeleteConfirm = (id) => {
    showCustomModal("Tem certeza que deseja excluir esta banca?", "confirm", () => handleDelete(id));
  };

  // Função para excluir uma banca
  const handleDelete = async (id) => {
    closeCustomModal(); // Fechar o modal de confirmação
    if (!firebaseReady || !db || !userId) {
      showCustomModal("Sistema não está pronto. Por favor, aguarde um momento.", "error");
      return;
    }
    try {
      await db.collection(`users/${userId}/periodos/${periodoSelecionado}/bancas`).doc(id).delete();
      setSucesso("Banca excluída com sucesso!");
      showCustomModal("Banca excluída com sucesso!", "success");
    } catch (error) {
      console.error("Erro ao excluir banca:", error);
      setErro("Erro ao excluir banca. Por favor, tente novamente.");
      showCustomModal("Erro ao excluir banca. Por favor, tente novamente.", "error");
    }
  };

  // Função para formatar a data para exibição
  const formatarData = (dataString) => {
    if (!dataString) return '';
    try {
      const [ano, mes, dia] = dataString.split('-');
      return `${dia}/${mes}/${ano}`;
    } catch (e) {
      return dataString; // Retorna a string original se houver erro na formatação
    }
  };

  return (
    <div className="min-h-screen bg-gray-100 p-4 font-inter">
      <div className="max-w-6xl mx-auto bg-white p-6 rounded-lg shadow-md">
        {/* Header com seletor de período */}
        <div className="flex flex-col md:flex-row justify-between items-center mb-6">
          <h1 className="text-3xl font-bold text-gray-800 mb-4 md:mb-0">
            🎓 Gerenciador de Bancas de TCC
          </h1>
          
          <div className="flex flex-col sm:flex-row gap-3 items-center">
            <div className="flex items-center gap-2">
              <label className="text-sm font-medium text-gray-700">Período:</label>
              <select 
                value={periodoSelecionado} 
                onChange={(e) => setPeriodoSelecionado(e.target.value)}
                className="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {periodos.map(periodo => (
                  <option key={periodo} value={periodo}>{periodo}</option>
                ))}
              </select>
            </div>
            
            <button
              onClick={() => setShowConfigModal(true)}
              className="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm"
            >
              ⚙️ Configurar Período
            </button>
          </div>
                </div>

        {/* Status do Firebase */}
        {!firebaseReady && (
          <div className="mb-4 text-center text-sm text-yellow-600 bg-yellow-100 p-2 rounded">
            🔄 Conectando ao Firebase...
          </div>
        )}
        {firebaseReady && !userId && (
          <div className="mb-4 text-center text-sm text-blue-600 bg-blue-100 p-2 rounded">
            🔄 Inicializando sistema...
          </div>
        )}

        {/* Informações do Período Atual */}
        {periodoSelecionado && (
          <div className="mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center">
              <div>
                <h2 className="text-xl font-semibold text-gray-800 mb-2">
                  📅 Período: {periodoSelecionado}
                </h2>
                <div className="text-sm text-gray-600 space-y-1">
                  <div>📚 {bancas.length} bancas agendadas</div>
                  <div>🏫 {salas.length} salas disponíveis</div>
                  <div>👥 {professores.length} professores cadastrados</div>
                  <div>📅 {datasDisponiveis.length} datas disponíveis</div>
                </div>
              </div>
              
              <div className="mt-4 md:mt-0">
                <button
                  onClick={() => {
                    const configAtual = {
                      periodo: periodoSelecionado,
                      salas: salas.join(', '),
                      datas: datasDisponiveis.join(', '),
                      professores: professores.join(', ')
                    };
                    setNovaConfiguracao(configAtual);
                    setShowConfigModal(true);
                  }}
                  className="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm"
                >
                  ✏️ Editar Configurações
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Exibe o ID do usuário para fins de depuração/identificação */}
        {userId && (
          <div className="mb-4 text-center text-sm text-gray-600">
            Seu ID de Usuário: <span className="font-mono bg-gray-200 p-1 rounded">{userId}</span>
          </div>
        )}

        {/* Formulário para adicionar/editar banca */}
        <div className="mb-8 p-6 bg-blue-50 rounded-lg shadow-inner">
          <h2 className="text-2xl font-semibold mb-4 text-blue-700">
            {editandoBancaId ? 'Editar Banca' : 'Adicionar Nova Banca'}
          </h2>
          <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label htmlFor="data" className="block text-sm font-medium text-gray-700">Data</label>
              <select
                id="data"
                name="data"
                value={novaBanca.data}
                onChange={handleChange}
                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required
              >
                <option value="">Selecione uma data</option>
                {datasDisponiveis.map((data, index) => (
                  <option key={index} value={data}>{formatarData(data)}</option>
                ))}
                {/* Adicionar opção para inserir nova data */}
                <option value="Outra">Outra (digitar)</option>
              </select>
              {novaBanca.data === '' && ( // Renderiza o input se a data for vazia (após selecionar "Outra")
                <input
                  type="date"
                  name="data"
                  value={novaBanca.data} // Agora novaBanca.data será ''
                  onChange={(e) => setNovaBanca(prev => ({ ...prev, data: e.target.value }))}
                  placeholder="Selecione a nova data"
                  className="mt-2 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                  required
                />
              )}
            </div>
            <div>
              <label htmlFor="horarioInicio" className="block text-sm font-medium text-gray-700">Horário Início</label>
              <input
                type="time"
                id="horarioInicio"
                name="horarioInicio"
                value={novaBanca.horarioInicio}
                onChange={handleChange}
                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required
              />
            </div>
            <div>
              <label htmlFor="horarioFim" className="block text-sm font-medium text-gray-700">Horário Fim</label>
              <input
                type="time"
                id="horarioFim"
                name="horarioFim"
                value={novaBanca.horarioFim}
                onChange={handleChange}
                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required
              />
            </div>
            <div>
              <label htmlFor="local" className="block text-sm font-medium text-gray-700">Local</label>
              <select
                id="local"
                name="local"
                value={novaBanca.local}
                onChange={handleChange}
                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required
              >
                <option value="">Selecione um local</option>
                {salas.map((sala, index) => (
                  <option key={index} value={sala}>{sala}</option>
                ))}
                {/* Adicionar opção para inserir novo local */}
                <option value="Outro">Outro (digitar)</option>
              </select>
              {novaBanca.local === 'Outro' && (
                <input
                  type="text"
                  name="local"
                  value={novaBanca.local === 'Outro' ? '' : novaBanca.local} // Limpa o campo se "Outro" for selecionado
                  onChange={(e) => setNovaBanca(prev => ({ ...prev, local: e.target.value }))}
                  placeholder="Digite o novo local"
                  className="mt-2 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                  required
                />
              )}
            </div>
            <div>
              <label htmlFor="discente" className="block text-sm font-medium text-gray-700">Discente</label>
              <input
                type="text"
                id="discente"
                name="discente"
                value={novaBanca.discente}
                onChange={handleChange}
                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required
              />
            </div>
            <div>
              <label htmlFor="titulo" className="block text-sm font-medium text-gray-700">Título / Tema</label>
              <input
                type="text"
                id="titulo"
                name="titulo"
                value={novaBanca.titulo}
                onChange={handleChange}
                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required
              />
            </div>
            <div>
              <label htmlFor="orientador" className="block text-sm font-medium text-gray-700">Orientador</label>
              <select
                id="orientador"
                name="orientador"
                value={novaBanca.orientador}
                onChange={handleChange}
                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required
              >
                <option value="">Selecione um orientador</option>
                {professores.map((prof, index) => (
                  <option key={index} value={prof}>{prof}</option>
                ))}
                {/* Adicionar opção para inserir novo professor */}
                <option value="Outro">Outro (digitar)</option>
              </select>
              {novaBanca.orientador === 'Outro' && (
                <input
                  type="text"
                  name="orientador"
                  value={novaBanca.orientador === 'Outro' ? '' : novaBanca.orientador}
                  onChange={(e) => setNovaBanca(prev => ({ ...prev, orientador: e.target.value }))}
                  placeholder="Digite o nome do novo orientador"
                  className="mt-2 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                  required
                />
              )}
            </div>
            <div>
              <label htmlFor="avaliador1" className="block text-sm font-medium text-gray-700">Avaliador 1</label>
              <select
                id="avaliador1"
                name="avaliador1"
                value={novaBanca.avaliador1}
                onChange={handleChange}
                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required
              >
                <option value="">Selecione um avaliador</option>
                {professores.map((prof, index) => (
                  <option key={index} value={prof}>{prof}</option>
                ))}
              </select>
            </div>
            <div>
              <label htmlFor="avaliador2" className="block text-sm font-medium text-gray-700">Avaliador 2</label>
              <select
                id="avaliador2"
                name="avaliador2"
                value={novaBanca.avaliador2}
                onChange={handleChange}
                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required
              >
                <option value="">Selecione um avaliador</option>
                {professores.map((prof, index) => (
                  <option key={index} value={prof}>{prof}</option>
                ))}
              </select>
            </div>
            <div className="md:col-span-2 flex justify-end space-x-2">
              <button
                type="submit"
                className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-lg transition duration-300 ease-in-out transform hover:scale-105"
              >
                {editandoBancaId ? 'Atualizar Banca' : 'Adicionar Banca'}
              </button>
              {editandoBancaId && (
                <button
                  type="button"
                  onClick={() => {
                    setEditandoBancaId(null);
                    setNovaBanca({
                      data: '', horarioInicio: '', horarioFim: '', local: '', discente: '',
                      titulo: '', orientador: '', avaliador1: '', avaliador2: '',
                    });
                    setErro('');
                    setSucesso('');
                  }}
                  className="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-md shadow-lg transition duration-300 ease-in-out transform hover:scale-105"
                >
                  Cancelar Edição
                </button>
              )}
            </div>
          </form>
        </div>

        {/* Visualização em Calendário Semanal */}
        {bancas.length > 0 && (
          <div className="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 className="text-2xl font-semibold mb-4 text-gray-800">📅 Visualização Semanal</h2>
            <div className="bg-gray-50 p-4 rounded-lg">
              <h3 className="text-lg font-semibold text-center mb-4 text-gray-800">Semana de 04/08 a 10/08/2025</h3>
              <div className="grid grid-cols-7 gap-2">
                {/* Cabeçalho dos dias da semana */}
                {[
                  { dia: 'Dom', data: '2025-08-03', label: '03/08' },
                  { dia: 'Seg', data: '2025-08-04', label: '04/08' },
                  { dia: 'Ter', data: '2025-08-05', label: '05/08' },
                  { dia: 'Qua', data: '2025-08-06', label: '06/08' },
                  { dia: 'Qui', data: '2025-08-07', label: '07/08' },
                  { dia: 'Sex', data: '2025-08-08', label: '08/08' },
                  { dia: 'Sáb', data: '2025-08-09', label: '09/08' }
                ].map(({ dia, data, label }) => {
                  const bancasDoDia = bancas.filter(b => b.data === data);
                  const hoje = new Date().toISOString().split('T')[0];
                  const isHoje = data === hoje;
                  
                  return (
                    <div key={data} className="flex flex-col">
                      {/* Cabeçalho do dia */}
                      <div className={`p-2 text-center font-medium text-sm rounded-t ${
                        isHoje 
                          ? 'bg-blue-600 text-white' 
                          : 'bg-gray-200 text-gray-700'
                      }`}>
                        <div className="font-bold">{dia}</div>
                        <div className="text-xs">{label}</div>
                      </div>
                      
                      {/* Conteúdo do dia */}
                      <div className={`flex-1 p-2 border border-gray-200 rounded-b min-h-[120px] ${
                        bancasDoDia.length > 0 
                          ? 'bg-blue-50 border-blue-300' 
                          : 'bg-white'
                      }`}>
                        {bancasDoDia.length === 0 ? (
                          <div className="text-center text-gray-400 text-xs mt-4">
                            Sem bancas
                          </div>
                        ) : (
                          <div className="space-y-1">
                            {bancasDoDia.map((banca, index) => (
                              <div key={banca.id} className="bg-white p-2 rounded border border-blue-200 text-xs">
                                <div className="font-bold text-blue-700">
                                  {banca.horarioInicio} - {banca.horarioFim}
                                </div>
                                <div className="text-gray-700 truncate">
                                  {banca.discente}
                                </div>
                                <div className="text-gray-500 truncate">
                                  {banca.local}
                                </div>
                                <div className="text-gray-600 mt-1 space-y-0.5">
                                  <div className="truncate">🎓 {banca.orientador}</div>
                                  <div className="truncate">👥 {banca.avaliador1}</div>
                                  {banca.avaliador2 && (
                                    <div className="truncate">👥 {banca.avaliador2}</div>
                                  )}
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        )}

        {/* Lista de Bancas */}
        <div className="bg-white p-6 rounded-lg shadow-md">
          <h2 className="text-2xl font-semibold mb-4 text-gray-800">📊 Lista Completa de Bancas</h2>
          {bancas.length === 0 ? (
            <p className="text-center text-gray-600">Nenhuma banca agendada ainda.</p>
          ) : (
            <div className="overflow-x-auto">
              <table className="min-w-full bg-white border border-gray-200 rounded-lg">
                <thead className="bg-gray-200">
                  <tr>
                    <th className="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Data</th>
                    <th className="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Horário</th>
                    <th className="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Local</th>
                    <th className="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Discente</th>
                    <th className="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Orientador</th>
                    <th className="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Avaliadores</th>
                    <th className="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Ações</th>
                  </tr>
                </thead>
                <tbody>
                  {bancas.map((banca) => (
                    <React.Fragment key={banca.id}>
                      {/* Linha principal com informações básicas */}
                      <tr className="hover:bg-gray-50">
                        <td className="py-2 px-4 border-b text-sm text-gray-700">{formatarData(banca.data)}</td>
                        <td className="py-2 px-4 border-b text-sm text-gray-700">{banca.horarioInicio} - {banca.horarioFim}</td>
                        <td className="py-2 px-4 border-b text-sm text-gray-700">{banca.local}</td>
                        <td className="py-2 px-4 border-b text-sm text-gray-700">{banca.discente}</td>
                        <td className="py-2 px-4 border-b text-sm text-gray-700">{banca.orientador}</td>
                        <td className="py-2 px-4 border-b text-sm text-gray-700">
                          {banca.avaliador1}{banca.avaliador2 ? ` / ${banca.avaliador2}` : ''}
                        </td>
                        <td className="py-2 px-4 border-b text-sm text-gray-700">
                          <button
                            onClick={() => handleEdit(banca)}
                            className="bg-yellow-500 hover:bg-yellow-600 text-white py-1 px-3 rounded-md text-xs mr-2 shadow-md transition duration-300 ease-in-out transform hover:scale-105"
                          >
                            Editar
                          </button>
                          <button
                            onClick={() => handleDeleteConfirm(banca.id)}
                            className="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded-md text-xs shadow-md transition duration-300 ease-in-out transform hover:scale-105"
                          >
                            Excluir
                          </button>
                        </td>
                      </tr>
                      {/* Linha adicional com o título do trabalho */}
                      <tr className="hover:bg-gray-50 bg-gray-50">
                        <td colSpan="7" className="py-2 px-4 border-b text-sm">
                          <div className="flex items-center">
                            <span className="font-medium text-gray-700 mr-2">📋 Título:</span>
                            <span className="text-gray-800 italic">{banca.titulo}</span>
                          </div>
                        </td>
                      </tr>
                    </React.Fragment>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>

        {/* Estatísticas de Participação dos Professores */}
        {bancas.length > 0 && (
          <div className="bg-white p-6 rounded-lg shadow-md mt-6">
            <h2 className="text-2xl font-semibold mb-4 text-gray-800">Estatísticas de Participação dos Professores</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {(() => {
                // Calcular estatísticas de participação
                const estatisticas = {};
                
                bancas.forEach(banca => {
                  // Contar orientador
                  if (banca.orientador) {
                    estatisticas[banca.orientador] = estatisticas[banca.orientador] || { orientador: 0, avaliador: 0, total: 0 };
                    estatisticas[banca.orientador].orientador++;
                    estatisticas[banca.orientador].total++;
                  }
                  
                  // Contar avaliador 1
                  if (banca.avaliador1) {
                    estatisticas[banca.avaliador1] = estatisticas[banca.avaliador1] || { orientador: 0, avaliador: 0, total: 0 };
                    estatisticas[banca.avaliador1].avaliador++;
                    estatisticas[banca.avaliador1].total++;
                  }
                  
                  // Contar avaliador 2
                  if (banca.avaliador2) {
                    estatisticas[banca.avaliador2] = estatisticas[banca.avaliador2] || { orientador: 0, avaliador: 0, total: 0 };
                    estatisticas[banca.avaliador2].avaliador++;
                    estatisticas[banca.avaliador2].total++;
                  }
                });
                
                // Ordenar por total de participações (decrescente)
                const professoresOrdenados = Object.entries(estatisticas)
                  .sort(([,a], [,b]) => b.total - a.total);
                
                return professoresOrdenados.map(([professor, stats]) => (
                  <div key={professor} className="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                    <h3 className="font-semibold text-lg text-gray-800 mb-2">{professor}</h3>
                    <div className="space-y-1 text-sm">
                      <div className="flex justify-between">
                        <span className="text-gray-600">Total de participações:</span>
                        <span className="font-bold text-blue-600">{stats.total}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Como orientador:</span>
                        <span className="font-medium text-green-600">{stats.orientador}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Como avaliador:</span>
                        <span className="font-medium text-purple-600">{stats.avaliador}</span>
                      </div>
                    </div>
                  </div>
                ));
              })()}
            </div>
            
            {/* Resumo Geral */}
            <div className="mt-6 p-4 bg-gray-50 rounded-lg">
              <h3 className="font-semibold text-lg text-gray-800 mb-3">Resumo Geral</h3>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div className="bg-white p-3 rounded-lg shadow-sm">
                  <div className="text-2xl font-bold text-blue-600">{bancas.length}</div>
                  <div className="text-sm text-gray-600">Total de Bancas</div>
                </div>
                <div className="bg-white p-3 rounded-lg shadow-sm">
                  <div className="text-2xl font-bold text-green-600">
                    {bancas.filter(b => b.orientador).length}
                  </div>
                  <div className="text-sm text-gray-600">Orientadores Únicos</div>
                </div>
                <div className="bg-white p-3 rounded-lg shadow-sm">
                  <div className="text-2xl font-bold text-purple-600">
                    {new Set([
                      ...bancas.map(b => b.avaliador1).filter(Boolean),
                      ...bancas.map(b => b.avaliador2).filter(Boolean)
                    ]).size}
                  </div>
                  <div className="text-sm text-gray-600">Avaliadores Únicos</div>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>

      {/* Modal de Configuração de Períodos */}
      {showConfigModal && (
        <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-gray-800">
                ⚙️ {periodos.includes(novaConfiguracao.periodo) ? 'Editar' : 'Configurar Novo'} Período
              </h3>
              <button
                onClick={() => setShowConfigModal(false)}
                className="text-gray-500 hover:text-gray-700 text-2xl"
              >
                ×
              </button>
            </div>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Nome do Período (ex: 2025.2, 2026.1)
                </label>
                <input
                  type="text"
                  value={novaConfiguracao.periodo}
                  onChange={(e) => setNovaConfiguracao(prev => ({ ...prev, periodo: e.target.value }))}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="2025.2"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Salas Disponíveis (separadas por vírgula)
                </label>
                <textarea
                  value={novaConfiguracao.salas}
                  onChange={(e) => setNovaConfiguracao(prev => ({ ...prev, salas: e.target.value }))}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="3"
                  placeholder="Sala de Arte e Tecnologia, Auditório Mário Meireles, (on-line)"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Datas Disponíveis (formato YYYY-MM-DD, separadas por vírgula)
                </label>
                <textarea
                  value={novaConfiguracao.datas}
                  onChange={(e) => setNovaConfiguracao(prev => ({ ...prev, datas: e.target.value }))}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="3"
                  placeholder="2025-12-01, 2025-12-02, 2025-12-03, 2025-12-04, 2025-12-05"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Professores Disponíveis (separados por vírgula)
                </label>
                <textarea
                  value={novaConfiguracao.professores}
                  onChange={(e) => setNovaConfiguracao(prev => ({ ...prev, professores: e.target.value }))}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="4"
                  placeholder="Dinho, Elisene, Frederico, Isabel, Jordana, Larissa, Luísa, Maira, Marcelo, Mariana, Mateus, Murilo, Pablo, Plínio, Paulo César, Vinícius"
                />
              </div>
            </div>
            
            <div className="flex justify-end space-x-3 mt-6">
              <button
                onClick={() => setShowConfigModal(false)}
                className="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors"
              >
                Cancelar
              </button>
              <button
                onClick={criarNovoPeriodo}
                className="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"
              >
                {periodos.includes(novaConfiguracao.periodo) ? 'Atualizar' : 'Criar'} Período
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Modal Personalizado */}
      {showModal && (
        <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
            <h3 className={`text-lg font-bold mb-4 ${modalType === 'error' ? 'text-red-600' : modalType === 'success' ? 'text-green-600' : 'text-gray-800'}`}>
              {modalType === 'error' ? 'Erro!' : modalType === 'success' ? 'Sucesso!' : 'Confirmação'}
            </h3>
            <p className="mb-4 text-gray-700">{modalMessage}</p>
            <div className="flex justify-end space-x-2">
              {modalType === 'confirm' && (
                <>
                  <button
                    onClick={closeCustomModal}
                    className="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md transition duration-300"
                  >
                    Cancelar
                  </button>
                  <button
                    onClick={() => {
                      if (modalAction) modalAction();
                    }}
                    className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300"
                  >
                    Confirmar
                  </button>
                </>
              )}
              {(modalType === 'success' || modalType === 'error') && (
                <button
                  onClick={closeCustomModal}
                  className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300"
                >
                  OK
                </button>
              )}
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// Renderiza o componente React (versão compatível com CDN)
ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
